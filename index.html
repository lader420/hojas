<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TechPro v21.5 | Industrial Mobile Edition</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --p: #6366f1; --bg: #020617; --card: rgba(15, 23, 42, 0.98); }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: #f1f5f9; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* Est√©tica de Interfaz Industrial */
        .glass { background: var(--card); backdrop-filter: blur(30px); border: 1px solid rgba(255, 255, 255, 0.08); }
        
        /* Navegaci√≥n H√≠brida (Sidebar en PC, Bottom Nav en M√≥vil) */
        .nav-link { transition: 0.3s; color: #64748b; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; font-weight: 800; border-radius: 1rem; }
        .nav-link.active { color: white; background: rgba(99, 102, 241, 0.1); border-bottom: 3px solid var(--p); }

        @media (min-width: 1024px) {
            body { flex-direction: row; }
            .sidebar { width: 320px; height: 100vh; display: flex; flex-direction: column; margin: 16px; border-radius: 3rem; position: relative; }
            .nav-link { flex-direction: row; justify-content: flex-start; padding: 18px 24px; font-size: 14px; gap: 15px; border-bottom: none; }
            .nav-link.active { border-left: 5px solid #fff; background: linear-gradient(90deg, var(--p) 0%, transparent 100%); }
            .mobile-nav { display: none; }
        }

        /* Inputs de Alto Contraste */
        .ent-input { background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.1); outline: none; transition: 0.3s; color: white; -webkit-appearance: none; }
        .ent-input:focus { border-color: var(--p); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2); }
        
        /* Checkbox Profesional */
        .chip-check { cursor: pointer; display: flex; align-items: center; gap: 10px; padding: 14px; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.08); border-radius: 1.2rem; font-size: 11px; transition: 0.2s; }
        .chip-check:has(input:checked) { border-color: var(--p); background: rgba(99, 102, 241, 0.15); color: #a5b4fc; }

        /* Contenedores de desplazamiento */
        .scroll-area { flex: 1; overflow-y: auto; padding-bottom: 100px; }
        @media (min-width: 1024px) { .scroll-area { padding-bottom: 20px; } }

        /* Impresi√≥n */
        @media print {
            .no-print { display: none !important; }
            #print-area { display: block !important; width: 80mm; padding: 5mm; color: black; background: white; font-family: 'Courier New'; font-size: 11px; }
        }
    </style>
</head>
<body class="flex">

    <aside class="no-print sidebar glass hidden lg:flex p-8">
        <div class="flex items-center gap-4 mb-12">
            <div class="w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center font-black text-2xl italic">T</div>
            <div>
                <h1 class="text-xl font-black italic">TECHPRO</h1>
                <p class="text-[9px] font-bold text-indigo-500 uppercase tracking-widest">Lab System v21.5</p>
            </div>
        </div>
        
        <nav class="flex-1 space-y-3">
            <div onclick="ui.view('dash')" id="m-dash-d" class="nav-link active"><span>üìä</span> Dashboard</div>
            <div onclick="ui.view('adm')" id="m-adm-d" class="nav-link"><span>üìù</span> Admisi√≥n</div>
            <div onclick="ui.view('taller')" id="m-taller-d" class="nav-link"><span>üîß</span> Laboratorio</div>
            <div onclick="ui.view('inv')" id="m-inv-d" class="nav-link"><span>üì¶</span> Inventario</div>
            <div onclick="ui.view('history')" id="m-history-d" class="nav-link"><span>üìö</span> Historial</div>
        </nav>

        <div class="mt-auto p-6 bg-indigo-600/5 rounded-[2rem] border border-white/5 text-center">
            <p id="clock" class="text-2xl font-black text-indigo-400 font-mono italic">00:00:00</p>
        </div>
    </aside>

    <nav class="no-print mobile-nav glass fixed bottom-0 left-0 right-0 z-[100] flex justify-around p-3 lg:hidden">
        <div onclick="ui.view('dash')" id="m-dash-m" class="nav-link active"><span>üìä</span>Inicio</div>
        <div onclick="ui.view('adm')" id="m-adm-m" class="nav-link"><span>üìù</span>Nuevo</div>
        <div onclick="ui.view('taller')" id="m-taller-m" class="nav-link"><span>üîß</span>Lab</div>
        <div onclick="ui.view('inv')" id="m-inv-m" class="nav-link"><span>üì¶</span>Stock</div>
        <div onclick="ui.view('history')" id="m-history-m" class="nav-link"><span>üìö</span>Hist</div>
    </nav>

    <main class="flex-1 flex flex-col p-4 lg:p-10 overflow-hidden">
        <header class="no-print flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
            <h2 id="view-title" class="text-4xl lg:text-6xl font-black italic uppercase tracking-tighter">Dashboard</h2>
            <div class="w-full md:w-auto">
                <input type="text" oninput="logic.search(this.value)" placeholder="Buscar cliente, folio, IMEI..." class="ent-input w-full md:w-96 p-4 rounded-2xl text-xs font-bold">
            </div>
        </header>

        <section id="main-view" class="scroll-area pr-2"></section>
    </main>

    <div id="modal-container" class="hidden fixed inset-0 bg-black/98 backdrop-blur-2xl z-[200] overflow-y-auto p-4 lg:p-10">
        <div class="glass w-full max-w-6xl mx-auto p-6 lg:p-14 rounded-[2.5rem] lg:rounded-[4rem] relative shadow-2xl my-4">
            <button onclick="ui.closeModal()" class="absolute right-6 top-6 lg:right-10 lg:top-10 text-slate-500 text-3xl">‚úï</button>
            <div id="modal-body"></div>
        </div>
    </div>

    <div id="print-area" class="hidden"></div>

    <script>
        // BASE DE DATOS Y L√ìGICA V21 MANTENIDA
        let db = {
            tickets: JSON.parse(localStorage.getItem('tt_v21_tks')) || [],
            inventory: JSON.parse(localStorage.getItem('tt_v21_inv')) || [],
            config: JSON.parse(localStorage.getItem('tt_v21_cfg')) || { name: "LAB PRO V21", address: "CALLE TECH 101", tel: "555-000", warranty: 90, currency: "$" }
        };

        const sync = () => { localStorage.setItem('tt_v21_tks', JSON.stringify(db.tickets)); localStorage.setItem('tt_v21_inv', JSON.stringify(db.inventory)); localStorage.setItem('tt_v21_cfg', JSON.stringify(db.config)); };

        const logic = {
            createTicket(e) {
                e.preventDefault();
                const f = new FormData(e.target);
                const id = Date.now();
                const objetos = [];
                document.querySelectorAll('input[name="objetos"]:checked').forEach(o => objetos.push(o.value));
                if(f.get('otros_obj')) objetos.push(f.get('otros_obj'));

                const t = {
                    id, folio: 'TK-' + id.toString().slice(-5), date: id,
                    client: f.get('client'), whatsapp: f.get('whatsapp'),
                    type: f.get('dev_type'), device: f.get('device'), serial: f.get('serial'),
                    objetos: objetos.join(', '), physical: f.get('physical'), fault: f.get('fault'),
                    pass: f.get('pass'), prio: f.get('prio'), status: 'Recibido', total: 0,
                    diagnosis: '', work_done: []
                };
                db.tickets.unshift(t); sync(); this.print(id, 'recepcion'); ui.view('taller');
            },

            manage(id) {
                const t = db.tickets.find(x => x.id === id);
                ui.openModal(`
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
                        <div class="lg:col-span-8 space-y-8">
                            <div>
                                <h3 class="text-4xl lg:text-5xl font-black italic uppercase text-indigo-400">${t.folio}</h3>
                                <p class="text-slate-500 font-bold uppercase tracking-widest mt-2">${t.client} | ${t.device}</p>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <h4 class="text-[10px] font-black text-indigo-400 uppercase italic tracking-[0.2em]">Checklist Mantenimiento</h4>
                                    <div class="grid grid-cols-1 gap-2">
                                        ${['Limpieza Interna', 'Pasta T√©rmica', 'Optimizaci√≥n', 'Ba√±o Isoprop√≠lico', 'Eliminaci√≥n Virus'].map(i => `
                                            <label class="chip-check"><input type="checkbox" name="work_item" value="${i}" ${t.work_done.includes(i)?'checked':''} class="hidden"><span>‚úîÔ∏è ${i}</span></label>
                                        `).join('')}
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <h4 class="text-[10px] font-black text-indigo-400 uppercase italic tracking-[0.2em]">Checklist Reparaci√≥n</h4>
                                    <div class="grid grid-cols-1 gap-2">
                                        ${['Pantalla', 'Bater√≠a', 'Pin de Carga', 'Reballing IC', 'C√°maras'].map(i => `
                                            <label class="chip-check"><input type="checkbox" name="work_item" value="${i}" ${t.work_done.includes(i)?'checked':''} class="hidden"><span>‚öôÔ∏è ${i}</span></label>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>

                            <textarea id="u-diag" class="ent-input w-full p-6 lg:p-8 rounded-[2rem] lg:rounded-[3rem] h-48 font-semibold" placeholder="Reporte t√©cnico detallado...">${t.diagnosis || ''}</textarea>
                        </div>

                        <div class="lg:col-span-4 space-y-6">
                            <div class="glass p-8 rounded-[3rem] border-indigo-600/20 bg-indigo-600/5">
                                <div class="space-y-6">
                                    <div>
                                        <label class="text-[10px] font-black text-slate-500 uppercase ml-2">Estado</label>
                                        <select id="u-status" class="ent-input w-full p-4 rounded-xl font-bold">
                                            <option value="Taller" ${t.status==='Taller'?'selected':''}>En Taller</option>
                                            <option value="Listo" ${t.status==='Listo'?'selected':''}>Listo</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-[10px] font-black text-slate-500 uppercase ml-2">Total ${db.config.currency}</label>
                                        <input id="u-total" type="number" value="${t.total}" class="ent-input w-full p-5 rounded-2xl text-emerald-400 font-black text-3xl">
                                    </div>
                                    <div class="flex flex-col gap-3">
                                        <button onclick="logic.commit(${t.id}, false)" class="w-full bg-white/10 py-4 rounded-2xl font-black uppercase text-[10px]">Guardar</button>
                                        <button onclick="logic.print(${t.id}, 'diagnostico')" class="w-full border border-indigo-600/30 text-indigo-400 py-4 rounded-2xl font-black uppercase text-[10px]">Imprimir</button>
                                        <button onclick="logic.commit(${t.id}, true)" class="w-full bg-indigo-600 py-6 rounded-[2rem] font-black uppercase text-xs shadow-2xl">Entregar Equipo</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `);
            },

            commit(id, deliver) {
                const t = db.tickets.find(x => x.id === id);
                t.status = deliver ? 'Entregado' : document.getElementById('u-status').value;
                t.total = document.getElementById('u-total').value;
                t.diagnosis = document.getElementById('u-diag').value;
                const jobs = [];
                document.querySelectorAll('input[name="work_item"]:checked').forEach(j => jobs.push(j.value));
                t.work_done = jobs;
                sync(); ui.closeModal(); if(deliver) this.print(id, 'entrega'); ui.view(deliver ? 'history' : 'taller');
            },

            print(id, type) {
                const t = db.tickets.find(x => x.id === id);
                const area = document.getElementById('print-area');
                let h = `<center><b>${db.config.name}</b><br>${db.config.tel}<br>--------------------------</center>`;
                if(type === 'recepcion') {
                    area.innerHTML = `${h}<center>FOLIO: ${t.folio}</center><br>CLIENTE: ${t.client}<br>EQUIPO: ${t.device}<br>FALLA: ${t.fault}<br>PASS: ${t.pass}<br><br><div id="qr-p" style="display:flex;justify-content:center"></div>`;
                    new QRCode(document.getElementById("qr-p"), { text: t.folio, width: 80, height: 80 });
                } else {
                    area.innerHTML = `${h}<center>SALIDA: ${t.folio}</center><br>EQUIPO: ${t.device}<br>PAGADO: ${db.config.currency}${t.total}<br>--------------------------<br><center>GARANTIA: ${db.config.warranty} DIAS</center>`;
                }
                setTimeout(() => { window.print(); }, 500);
            },

            search(q) {
                const f = db.tickets.filter(t => t.client.toLowerCase().includes(q.toLowerCase()) || t.folio.toLowerCase().includes(q.toLowerCase()));
                document.getElementById('main-view').innerHTML = f.map(t => ui.renderTicketCard(t)).join('');
            }
        };

        const ui = {
            view(id) {
                const s = document.getElementById('main-view');
                document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
                document.getElementById('m-'+id+'-d')?.classList.add('active');
                document.getElementById('m-'+id+'-m')?.classList.add('active');
                document.getElementById('view-title').innerText = id === 'adm' ? 'Admisi√≥n' : (id === 'taller' ? 'Taller' : id.toUpperCase());
                s.innerHTML = '';
                if(id === 'dash') this.rDash(s);
                if(id === 'adm') this.rAdm(s);
                if(id === 'taller') this.rTaller(s);
                if(id === 'inv') this.rInv(s);
                if(id === 'history') this.rHistory(s);
            },

            rDash(s) {
                const act = db.tickets.filter(t => t.status !== 'Entregado').length;
                s.innerHTML = `
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="glass p-10 rounded-[3rem] border-b-8 border-indigo-600">
                            <p class="text-[10px] font-black text-slate-500 uppercase italic">Laboratorio</p>
                            <h3 class="text-7xl font-black mt-2 italic">${act}</h3>
                        </div>
                        <div class="glass p-10 rounded-[3rem] border-b-8 border-emerald-500">
                            <p class="text-[10px] font-black text-slate-500 uppercase italic">Refacciones</p>
                            <h3 class="text-7xl font-black mt-2 italic text-emerald-500">${db.inventory.length}</h3>
                        </div>
                    </div>`;
            },

            rAdm(s) {
                s.innerHTML = `
                <div class="max-w-5xl mx-auto glass p-8 lg:p-14 rounded-[3rem] lg:rounded-[4rem]">
                    <form onsubmit="logic.createTicket(event)" class="space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input name="client" required placeholder="Cliente" class="ent-input p-6 rounded-2xl font-bold">
                            <input name="whatsapp" required placeholder="WhatsApp" class="ent-input p-6 rounded-2xl">
                            <select name="dev_type" class="ent-input p-6 rounded-2xl font-bold text-indigo-400">
                                <option>Laptop</option><option>Celular</option><option>Consola</option><option>Tablet</option>
                            </select>
                            <input name="device" required placeholder="Modelo/Marca" class="ent-input p-6 rounded-2xl font-bold">
                            <input name="serial" placeholder="IMEI / Serial" class="ent-input p-6 rounded-2xl">
                            <input name="pass" placeholder="PIN / Patr√≥n" class="ent-input p-6 rounded-2xl text-center font-mono">
                        </div>
                        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-2">
                            ${['Cargador', 'Funda', 'SIM', 'Mochila', 'Cable'].map(o => `<label class="chip-check"><input type="checkbox" name="objetos" value="${o}" class="hidden"><span>${o}</span></label>`).join('')}
                        </div>
                        <textarea name="fault" required placeholder="Falla t√©cnica reportada..." class="ent-input w-full p-8 rounded-[3rem] h-40 text-lg font-semibold"></textarea>
                        <button type="submit" class="w-full py-8 bg-indigo-600 rounded-[3rem] font-black text-2xl uppercase italic shadow-2xl">Iniciar Orden Lab</button>
                    </form>
                </div>`;
            },

            renderTicketCard(t) {
                return `
                    <div class="glass p-6 lg:p-8 rounded-[2.5rem] flex flex-col sm:flex-row justify-between items-center gap-6 mb-4 border-l-8 ${t.prio==='Urgente'?'border-rose-600':'border-indigo-600'}">
                        <div class="flex items-center gap-6 w-full sm:w-auto">
                            <div class="bg-black/50 p-4 rounded-2xl text-[10px] font-black text-indigo-400 text-center min-w-[80px]">${t.folio}</div>
                            <div>
                                <h4 class="text-2xl font-black italic uppercase">${t.client}</h4>
                                <p class="text-[10px] font-bold text-slate-500 tracking-widest uppercase">${t.device} ‚Ä¢ ${t.status}</p>
                            </div>
                        </div>
                        <button onclick="logic.manage(${t.id})" class="w-full sm:w-auto bg-white text-black px-12 py-4 rounded-2xl font-black text-[10px] uppercase shadow-lg hover:bg-indigo-600 hover:text-white transition-all">Abrir Laboratorio</button>
                    </div>`;
            },

            rTaller(s) {
                const act = db.tickets.filter(t => t.status !== 'Entregado');
                s.innerHTML = act.map(t => this.renderTicketCard(t)).join('') || '<div class="py-40 text-center opacity-10 text-6xl font-black italic">VAC√çO</div>';
            },

            rInv(s) {
                s.innerHTML = `<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    ${db.inventory.map(i => `<div class="glass p-8 rounded-[2.5rem] border-b-4 border-indigo-600"><h4 class="font-black italic">${i.name}</h4><p class="text-3xl font-black text-emerald-400">${db.config.currency}${i.price}</p></div>`).join('')}
                </div>`;
            },

            rHistory(s) {
                const h = db.tickets.filter(t => t.status === 'Entregado');
                s.innerHTML = h.map(t => this.renderTicketCard(t)).join('');
            },

            openModal(html) { document.getElementById('modal-body').innerHTML = html; document.getElementById('modal-container').classList.remove('hidden'); },
            closeModal() { document.getElementById('modal-container').classList.add('hidden'); }
        };

        window.onload = () => { ui.view('dash'); setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString('es-MX',{hour12:false}); }, 1000); };
    </script>
</body>
</html>
